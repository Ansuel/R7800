#!/bin/sh

if [ ! -f /tmp/modem ]; then
	/usr/sbin/net-wall-bin $*
else
	/usr/sbin/net-wall-bin -w eth0 $*
fi

if [ "$1" = "rule" ]; then
	# Check config file existence
	if [ -f /etc/netwall.conf ]; then
		config=/etc/netwall.conf
	elif [ -f /root/netwall-rules ]; then
		config=/root/netwall-rules
	else
		exit 0
	fi

	# Add own rules and remove "_lz4" occurrences if any
	mv -f /tmp/netwall-rules /tmp/netwall-rules.tmp
	cat $config > /tmp/netwall-rules
	sed 's/_lz4//g' /tmp/netwall-rules.tmp >> /tmp/netwall-rules
	rm -f /tmp/netwall-rules.tmp
fi
